<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üìò MARC21 Cataloger</title>
</head>
<body>
  <h2>Upload PDF or TXT</h2>
  <input type="file" id="fileInput" />
  <button onclick="upload()">üì§ Upload</button>
  <pre id="editor" contenteditable="true" style="white-space: pre-wrap; background: #f8f8f8; padding: 10px; border: 1px solid #ccc;"></pre>
  <br />
  <button onclick="downloadFile('record.mrk', 'text/plain')">üíæ Export .mrk</button>
  <button onclick="downloadFile('record.xml', 'application/xml')">üßæ Export .xml</button>
  <button onclick="downloadFile('record.json', 'application/json')">üìÑ Export .json</button>

  <script>
    async function upload() {
      const fileInput = document.getElementById("fileInput");
      const file = fileInput.files[0];
      const formData = new FormData();
      formData.append("file", file);

      const res = await fetch("https://htmlat3-api.onrender.com/extract", {
        method: "POST",
        body: formData
      });

      const data = await res.json();
      window.record = data;  // Save the whole response for export
      document.getElementById("editor").textContent =
        data.mrk || data.error || "‚ùå Error occurred.";
    }

    function downloadFile(filename, mime) {
      if (!window.record) return alert("‚ö†Ô∏è No record loaded.");
      let text = '';
      if (filename.endsWith('.mrk')) text = window.record.mrk;
      if (filename.endsWith('.xml')) text = window.record.xml;
      if (filename.endsWith('.json')) text = JSON.stringify(window.record.json, null, 2);

      const blob = new Blob([text], { type: mime });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      a.click();
    }
  </script>
</body>
</html>
